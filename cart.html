<!DOCTYPE html>
<html>
<head>
<title>Poco Online Shopping Center Cart</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://js.paystack.co/v1/inline.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial;}
body{background:#f2f2f2;padding:20px;}
h1{color:#f68b1e;margin-bottom:20px;}

.products{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:20px;
margin-bottom:40px;
}

.product{
background:white;
padding:15px;
border-radius:10px;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
text-align:center;
}

.product img{
    width:100%;
    height:180px;
    object-fit:contain;     /* makes image fit inside */
    background:#f5f5f5;     /* clean background */
    padding:10px;
    border-radius:8px;
}

.price{color:#f68b1e;font-weight:bold;margin:10px 0;}

button{padding:6px 10px;border:none;cursor:pointer;border-radius:4px;}

.add-btn{background:#f68b1e;color:white;}

.cart{
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

.cart-item{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:15px;
border-bottom:1px solid #ddd;
padding-bottom:10px;
gap:10px;
}

.qty-btn{
background:#f68b1e;
color:white;
padding:3px 8px;
}

.remove{background:red;color:white;font-size:12px;margin-top:4px;}

.total{font-weight:bold;margin-top:15px;}

.pay-btn{background:green;color:white;width:100%;padding:10px;font-size:16px;margin-top:10px;}

input, textarea, select{
width:100%;
padding:8px;
margin-bottom:10px;
}
</style>
</head>

<body>

<h1>Poco Cart System ðŸ›’</h1>

<div class="products">
<div class="product">
<img src="smartphone.jpeg">
<h4>Smartphone</h4>
<p class="price">120000</p>
<button class="add-btn" onclick="addToCart('Smartphone',120000)">Add to Cart</button>
</div>

<div class="product">
<img src="lap.png">
<h4>Laptop</h4>
<p class="price">350000</p>
<button class="add-btn" onclick="addToCart('Laptop',350000)">Add to Cart</button>
</div>
</div>

<div class="cart">
<h2>Your Cart</h2>
<div id="cartItems"></div>
<div class="total" id="totalPrice">Total: â‚¦0</div>

<button onclick="clearCart()" style="background:red;color:white;width:100%;margin-top:8px;">
Clear All Cart
</button>

<h3>Delivery</h3>
<select id="deliveryOption" onchange="displayCart()">
<option value="0">Pickup (Free)</option>
<option value="3000">Standard - â‚¦3,000</option>
<option value="7000">Express - â‚¦7,000</option>
</select>

<h3>Discount Coupon</h3>
<input type="text" id="couponCode" placeholder="Enter coupon code">
<button onclick="applyCoupon()" style="background:black;color:white;">
Apply Coupon
</button>
<p id="couponMessage" style="font-size:13px;"></p>

<h3>Customer Details</h3>
<input type="text" id="custName" placeholder="Full Name">
<input type="email" id="custEmail" placeholder="Email">
<input type="text" id="custPhone" placeholder="Phone">
<textarea id="custAddress" placeholder="Address"></textarea>

<h3>Payment Method</h3>
<select id="paymentMethod">
<option value="">Select Payment</option>
<option value="card">Card / Bank (Paystack)</option>
<option value="bank">Manual Bank Transfer</option>
</select>

<button class="pay-btn" onclick="processPayment()">Pay Now</button>
</div>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let discountPercent = 0;

function saveCart(){
localStorage.setItem("cart", JSON.stringify(cart));
}

function addToCart(name, price){
let item = cart.find(p => p.name === name);
if(item){ item.quantity++; }
else{ cart.push({name,price,quantity:1}); }
saveCart();
displayCart();
}

function increaseQty(index){
cart[index].quantity++;
saveCart();
displayCart();
}

function decreaseQty(index){
if(cart[index].quantity > 1){
cart[index].quantity--;
}else{
cart.splice(index,1);
}
saveCart();
displayCart();
}

function removeItem(index){
cart.splice(index,1);
saveCart();
displayCart();
}

function clearCart(){
if(confirm("Clear all items?")){
cart = [];
discountPercent = 0;
document.getElementById("couponMessage").innerText="";
saveCart();
displayCart();
}
}

function applyCoupon(){
const code = document.getElementById("couponCode").value.trim().toUpperCase();
const message = document.getElementById("couponMessage");

if(code === "POCO10"){
discountPercent = 10;
message.style.color="green";
message.innerText="10% Discount Applied";
}
else if(code === "POCO20"){
discountPercent = 20;
message.style.color="green";
message.innerText="20% Discount Applied";
}
else{
discountPercent = 0;
message.style.color="red";
message.innerText="Invalid Coupon";
}

displayCart();
}

function displayCart(){
const cartItems = document.getElementById("cartItems");
const totalPrice = document.getElementById("totalPrice");
const deliveryFee = parseInt(document.getElementById("deliveryOption").value);

cartItems.innerHTML = "";

if(cart.length === 0){
cartItems.innerHTML = "<p>Your cart is empty</p>";
totalPrice.innerText = "Total: â‚¦0";
return;
}

let subtotal = 0;

cart.forEach((item,index)=>{
subtotal += item.price * item.quantity;

cartItems.innerHTML += `
<div class="cart-item">
<div>
${item.name}<br>
â‚¦${item.price.toLocaleString()}
</div>

<div>
<button class="qty-btn" onclick="decreaseQty(${index})">âˆ’</button>
${item.quantity}
<button class="qty-btn" onclick="increaseQty(${index})">+</button>
</div>

<div>
â‚¦${(item.price * item.quantity).toLocaleString()}<br>
<button class="remove" onclick="removeItem(${index})">Remove</button>
</div>
</div>
`;
});

let discountAmount = (subtotal * discountPercent) / 100;
let total = subtotal - discountAmount + deliveryFee;

totalPrice.innerHTML = `
Subtotal: â‚¦${subtotal.toLocaleString()} <br>
Discount: âˆ’â‚¦${discountAmount.toLocaleString()} <br>
Delivery: â‚¦${deliveryFee.toLocaleString()} <br>
<strong>Total: â‚¦${total.toLocaleString()}</strong>
`;
}

function processPayment(){

if(cart.length === 0){
alert("Cart is empty!");
return;
}

const name = custName.value;
const email = custEmail.value;
const phone = custPhone.value;
const address = custAddress.value;
const method = document.getElementById("paymentMethod").value;
const deliveryFee = parseInt(document.getElementById("deliveryOption").value);

if(!name || !email || !phone || !address){
alert("Fill all customer details!");
return;
}

let subtotal = 0;
cart.forEach(item => subtotal += item.price * item.quantity);

let discountAmount = (subtotal * discountPercent) / 100;
let total = subtotal - discountAmount + deliveryFee;

if(method === "card"){

let handler = PaystackPop.setup({
key: 'pk_test_a14fbb26a424c4d32650cf93389ced8e4d1a1b87',
email: email,
amount: total * 100,
currency: "NGN",
ref: 'POCO-' + Math.floor(Math.random()*1000000000),

callback: function(response){

fetch("verify.php",{
method:"POST",
headers:{"Content-Type":"application/json"},
body: JSON.stringify({
reference: response.reference,
cart: cart,
name: name,
email: email,
phone: phone,
address: address,
total: total
})
})
.then(res=>res.json())
.then(data=>{
if(data.status === "success"){
alert("Payment Verified!");
cart = [];
discountPercent = 0;
saveCart();
displayCart();
window.location.href = "success.php?order_id="+data.order_id;
}else{
alert("Verification Failed");
}
});
},

onClose: function(){
alert("Payment cancelled");
}
});

handler.openIframe();
}

else if(method === "bank"){
alert("Transfer to:\nBank: Opay Bank\nAccount: 9136969853");
}
}

document.addEventListener("DOMContentLoaded", displayCart);

</script>

</body>
</html>